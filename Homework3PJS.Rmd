---
title: "Homework 3"
author: Patrick Sinclair
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
setwd("~/CCNY/Econometrics/Homework/Draft Hwk Files/Lab 2")
load("acs2017_ny_data.RData")
library(class)
```
For the initial k-nn classification, the determining variables were personal Income Total and Housing Cost, and the population was limited to NYC residents between the ages of 21 and 65.
 
```{r echo=FALSE}
dat_NYC <- subset(acs2017_ny, (acs2017_ny$in_NYC == 1)&(acs2017_ny$AGE > 20) & (acs2017_ny$AGE < 66))
attach(dat_NYC)
borough_f <- factor((in_Bronx + 2*in_Manhattan + 3*in_StatenI + 4*in_Brooklyn + 5*in_Queens), levels=c(1,2,3,4,5),labels = c("Bronx","Manhattan","Staten Island","Brooklyn","Queens"))
norm_varb <- function(X_in) {
  (max(X_in, na.rm = TRUE) - X_in)/( max(X_in, na.rm = TRUE) - min(X_in, na.rm = TRUE) )
}
is.na(OWNCOST) <- which(OWNCOST == 9999999)
housing_cost <- OWNCOST + RENT
norm_inc <- norm_varb(INCTOT)
norm_housing_cost <- norm_varb(housing_cost)
norm_householdinc <- norm_varb(HHINCOME)
data_use_prelim <- data.frame(norm_inc, norm_housing_cost)
good_obs_data_use <- complete.cases(data_use_prelim,borough_f)
dat_use <- subset(data_use_prelim,good_obs_data_use)
y_use <- subset(borough_f,good_obs_data_use)
set.seed(12345)
NN_obs <- sum(good_obs_data_use == 1)
select1 <- (runif(NN_obs) < 0.8)
train_data <- subset(dat_use,select1)
test_data <- subset(dat_use,(!select1))
cl_data <- y_use[select1]
true_data <- y_use[!select1]
```
Which returned the following results:
```{r echo=FALSE}
summary(cl_data)
prop.table(summary(cl_data))
summary(train_data)
```
Using these variables and a training data set of 80% of the already classified data points, the algorithm returned the following correct prediction rates of k = 1, 3, 5, 7 and 9.
```{r echo=FALSE}
for (indx in seq(1, 9, by= 2)) {
 pred_borough <- knn(train_data, test_data, cl_data, k = indx, l = 0, prob = FALSE, use.all = TRUE)
num_correct_labels <- sum(pred_borough == true_data)
correct_rate <- num_correct_labels/length(true_data)
print(c(indx,correct_rate))
}
```

The two variables good hand in hand - higher levels of income would suggest higher housing costs for those households. Of the two variables, I wanted to keep one constant and see how the predication rates would change in response to one variable change. Instead of using Income Total, which is per individual, I changed the variable to Household Income. This variable has more connection to housing costs. Individuals may work in low salaried positions but are still members of high income households. Changing income total to household income produced the following prediction rates.  
```{r echo=FALSE}
norm_famsize <- norm_varb(FAMSIZE)
data_use_prelimhh <- data.frame(norm_householdinc, norm_housing_cost)
good_obs_data_usehh <- complete.cases(data_use_prelimhh,borough_f)
dat_usehh <- subset(data_use_prelimhh,good_obs_data_usehh)
y_usehh <- subset(borough_f,good_obs_data_usehh)
NN_obshh <- sum(good_obs_data_usehh == 1)
select1 <- (runif(NN_obshh) < 0.8)
train_data <- subset(dat_usehh,select1)
test_data <- subset(dat_usehh,(!select1))
cl_data <- y_usehh[select1]
true_data <- y_usehh[!select1]
for (indx in seq(1, 9, by= 2)) {
 pred_borough <- knn(train_data, test_data, cl_data, k = indx, l = 0, prob = FALSE, use.all = TRUE)
num_correct_labels <- sum(pred_borough == true_data)
correct_rate <- num_correct_labels/length(true_data)
print(c(indx,correct_rate))
}
```

Including household income as a variable while holding housing cost constant improves the algorithms' ability to predict the classification of observations into the boroughs overall, with a noticeable larger uptick when k = 1.  However, as the k number increases, our prediction rate gets gradually less accurate. In the previous instance, there was a slight uptick in k = 7 and k = 9. I would contend that the downward trend in prediction rate is due to larger gaps between high income households and low income households than the comparative gaps for individuals.  

I would like to try to get the algorithm to predict at rates about 0.5 for the higher k values. Initially I thought it would be best to include a very different variable, such as linguistic isolation. Linguistic isolation is the term used to describe homes in which no one over the age of 14 spoke only English or spoke another language and English "very well". My assumption is that respondents in these households would generally live near and around each other, to ensure they are in a community in which they can interact and communicate with clearly and easily. However, including this variable reduced the predictive performance of the algorithm at all levels of k, by an average of 3.6% (k = 1 by 4.5%).

This result was surprising at first though upon reflection, two issues came to mind. The first is that the variable Linguistic Isolation is not rich enough to provide points of different for the algorithm. Its outcomes are either yes or no, essentially acting as a dummy variable. `r (sum(LINGISOL == 1)/sum(LINGISOL))` of respondents are not linguistically isolated and would not have to place as much importance on communication as a factor in deciding where to reside.
```{r}
norm_famsize <- norm_varb(FAMSIZE)
data_use_prelimhh <- data.frame(norm_householdinc, norm_famsize, norm_housing_cost)
# norm_housing_cost, LINGISOL
good_obs_data_use <- complete.cases(data_use_prelim,borough_f)
# good_obs_data_use <- complete.cases(data_use_prelim,in_Brooklyn)
dat_use <- subset(data_use_prelim,good_obs_data_use)
y_use <- subset(borough_f,good_obs_data_use)
# y_use <- subset(in_Brooklyn,good_obs_data_use)
```